<%- include('./partials/header') %>
<div class="w-full h-screen flex flex-col items-start px-20 py-20 gap-10">

    <!-- Cart Items Section -->
    <% let totalPrice = 0; %> <!-- Initialize total price variable -->
    <div class="w-full flex flex-wrap gap-10">
        <% if (user.cart && user.cart.length > 0) { %>
        <% user.cart.forEach((product, index) => { %> <!-- Loop through each item in the cart -->
            <div class="w-[30%] rounded-md overflow-hidden mb-10"> <!-- Individual product card wrapper -->
                
                <!-- Product Image Section -->
                <div class="w-full flex justify-center items-center h-80 bg-[<%= product.bgcolor %>]">
                    <!-- Product image rendered from base64 data -->
                    <img class="h-[18rem]" src="data:image/jpeg;base64, <%= product.image.toString('base64') %>" alt="Product Image">
                </div>
                
                <!-- Product Title and Quantity Control -->
                <div class="w-full flex justify-between px-5 py-4 bg-[<%= product.panelcolor %>]">
                    <h3 class="text-white text-2xl"><%= product.name %></h3> <!-- Display product name -->
                    <div class="flex items-center gap-2">
                        <i class="w-7 h-7 bg-white flex rounded-full items-center justify-center ri-add-line"></i> <!-- Add button -->
                        <div class="px-2 py-1 rounded-md bg-white text-black">01</div> <!-- Quantity display -->
                        <i class="w-7 h-7 bg-white flex rounded-full items-center justify-center ri-subtract-line"></i> <!-- Subtract button -->
                    </div>
                </div>

                <!-- Product Price Breakdown -->
                <div class="px-5 py-3 bg-[<%= product.textcolor %>]">
                    <div class="flex justify-between">
                        <h4>Total MRP</h4>
                        <h4>₹ <%= product.price %></h4>
                    </div>
                    <div class="flex justify-between">
                        <h4>Discount</h4>
                        <h4>₹ <%= product.discount %></h4>
                    </div>
                    <div class="flex justify-between text-white font-semibold">
                        <h4>Net Total</h4>
                        <h4>₹ <%= product.price - product.discount %></h4>
                    </div>
                </div>
            </div>
            <% totalPrice += (product.price - product.discount); %> <!-- Accumulate net price -->
        <% }) %>
    </div>

    <!-- Total Amount and Checkout Section -->
    <div class="w-full mt-10">
        <div class="flex justify-between px-20 text-xl">
            <h3>Total Amount</h3>
            <h3 class="font-semibold text-green-600">₹ <%= totalPrice %></h3> <!-- Display calculated total price -->
        </div>

        <!-- Checkout Form -->
        <form action="/checkout" method="POST" class="flex justify-end mt-5 px-20">
            <button type="submit" class="px-5 py-3 bg-green-600 text-white rounded">Proceed to Checkout</button>
        </form>
    </div>
    <% } else { %>
        <!-- Empty Cart Message (when cart has no items) -->
        <div class="w-full flex flex-col items-center justify-center h-full text-center">
            <h2 class="text-2xl font-semibold mb-4">Your Cart is Empty</h2>
            <p class="mb-6">Looks like you haven't added anything to your cart yet.</p>
            <a href="/shop" class="px-5 py-3 bg-blue-600 text-white rounded">View Our Collection</a>
        </div>
    <% } %>

</div>
<%- include('./partials/footer') %>
